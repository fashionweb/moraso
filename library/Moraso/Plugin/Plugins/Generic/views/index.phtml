var center = Ext.getCmp('viewport-center');
center.removeAll();

var pluginsGrid = new Ext.grid.GridPanel({
    title: '<?php echo Aitsu_Translate::translate('Plugins'); ?>',
    id: 'pluginsGrid',
    store: new Ext.data.JsonStore({
        url: '<?php echo $this->url(array('paction' => 'store')); ?>',
        root: 'plugins',
        fields: [
            'id',
            'namespace',
            'dir',
            'name',
            'type',
            'author',
            'copyright'
        ],
        autoLoad: true
    }),
    columns: [{
        dataIndex: 'id',
            type: 'int',
            width: 250,
            fixed: true,
            header: 'ID',
            menuDisabled: true
    }, {
            dataIndex: 'namespace',
            header: 'Namespace',
            width: 100,
            fixed: true,
            menuDisabled: true
    }, {
            dataIndex: 'name',
            header: 'Name',
            width: 125,
            fixed: true,
            menuDisabled: true
    }, {
            dataIndex: 'type',
            header: 'Type',
            width: 100,
            fixed: true,
            menuDisabled: true
    }, {
            dataIndex: 'author',
            header: 'Author',
            width: 150,
            fixed: true,
            menuDisabled: true
    }, {
            dataIndex: 'copyright',
            header: 'Copyright',
            width: 150,
            fixed: true,
            menuDisabled: true
    }],
    viewConfig: {
	forceFit: true,
	autoFill: true
    },
    tbar: {
        items: [{
            tooltip: '<?php echo Aitsu_Translate::translate('Refresh list'); ?>',
            iconCls: 'tb-refresh',
            handler: function(b, e) {
                Ext.getCmp('pluginsGrid').getStore().load();
            }
        }]
    },
    listeners: {
        rowcontextmenu: function(grid, rowIndex, event) {
            this.getSelectionModel().selectRow(rowIndex);
                
            var plugin = this.getStore().getAt(rowIndex);
                
            var menu = new Ext.menu.Menu();
              
            menu.addItem({
                text: 'Rechte anlegen',
                iconCls: 'tb-add',
                handler: function() {
                    Ext.Ajax.request({
                        url: '<?php echo $this->url(array('paction' => 'install')); ?>',
                        success: function(response, opts) {
                            var rsp = Ext.decode(response.responseText);
                            if (rsp.success) {
                                Ext.aitsu.msg('Rechte angelegt', 'Die Rechte f√ºr dieses Plugin wurden angelegt!');
                                grid.getStore().load(); 
                            }
                        },
                        params: {
                            namespace: plugin.get('namespace'),
                            dir: plugin.get('dir'),
                            type: plugin.get('type')
                        }
                    });
                }
            });
             
            menu.showAt(event.getXY());
        }		
    }
});

center.add(pluginsGrid);

Ext.getCmp('viewport').doLayout();